name: Update C# Driver

on:
  schedule:
    # Run daily at staggered times
    - cron: '0 2 * * *'

  workflow_dispatch:
    inputs:
      force_recreate:
        description: 'Force recreate JSON file with all releases'
        required: false
        type: boolean
        default: false

jobs:
  update-csharp:
    uses: ./.github/workflows/update-single-driver.yml
    with:
      driver_name: 'csharp'
      driver_display_name: 'C#'
      repo_name: 'mongodb/mongo-csharp-driver'
      force_recreate: ${{ fromJSON(github.event.inputs.force_recreate || 'false') }}
    secrets: inherit

  notify:
    needs: update-csharp
    runs-on: ubuntu-latest
    if: always()
    steps:
    - name: Create summary
      run: |
        echo "## 🔄 C# Driver Update Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Repository:** https://github.com/mongodb/mongo-csharp-driver" >> $GITHUB_STEP_SUMMARY
        echo "**Force Recreate:** ${{ github.event.inputs.force_recreate }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        if [ "${{ needs.update-csharp.result }}" == "success" ]; then
          echo "✅ **Status:** Workflow completed successfully" >> $GITHUB_STEP_SUMMARY
        else
          echo "❌ **Status:** Workflow failed or was cancelled" >> $GITHUB_STEP_SUMMARY
        fi
